(this.$WP=this.$WP||[]).push(["mT-Pb2",(e,n)=>{"use strict";var a,o,s,t,l,i,r,u,c,d,g,f,m,C,p,y=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],S=({allowClose:e,flow:n,forceLogin:s,contextualMessagingVariant:t,contextualMessageKey:l,contextualMessageParamKey:r,contextualMessageParam:u,contextualMessageSubheaderKey:c,isSignInOnly:d,onClose:g,onFailure:f,funnelKey:m,pid:C})=>{var{login:p,close:S}=i(),v=a(()=>{var e={contextualMessage:l,contextualMessageParamKey:r,contextualMessageParam:u,contextualMessageSubheader:c};return Object.assign({},t?{}:e,{isSignInOnly:d,contextualMessagingVariant:t,funnelKey:m})},[l,u,r,c,t,d,m]),h=y.includes((n||"").toUpperCase());return{login:o(a=>p({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:s,requireSecure:s,closeX:e,closeOnDocClick:e,hideBoxShadow:h,extraQueryParams:v,pid:C||40777,onSuccess:a||void 0,onClose:g,onFailure:f}),[e,v,h,n,s,p,g,f,C]),close:S}},v=({members:e,nonMembers:n,messageVariant:a,onClose:i,flow:c="OPTIMUS_BRANDED",funnelKey:f,pid:m})=>{var{userId:C}=s(u),p=g(),y=r("phoenix_plus"),{login:v}=S(Object.assign({allowClose:!0,forceLogin:!1},a&&{flow:c,contextualMessagingVariant:a},{onClose:i,funnelKey:f,pid:m})),[h,I]=t(!1),{data:M,fetching:k}=d();return l(()=>{(C||y)&&h&&!k&&((null==M?void 0:M.isSubscribed)?p(e):p(n))},[M,k,e,p,n,h,C,y]),o(()=>{C||y?I(!0):v(()=>{I(!0)})},[v,I,C,y])},h=()=>{var e=f(),[{page:n}]=s(c);return o(({locationId:a,listingKey:o=null,funnelKey:s})=>{if(!a||!s)throw new Error("Unable to record user login. Missing offer data - "+JSON.stringify({locationId:a,funnelKey:s}));e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:a,funnelKey:s,listingKey:o}}})},[e,n])},I=({children:e,forceLogin:n,loginContextualMessageKey:a,shouldLogoutAfterPaymentFailures:i=!1,renderBeforeLogout:r})=>{var[d,g]=t(!n),[f,C]=t(!1),[p]=s(c),{failedCardPayment:y,hasBlockedCardInSession:v,hadBlockedCard:h,clearAllBlockedCards:I}=(()=>{var[e,n]=t(!1),[a,s]=t(new Map);return{failedCardPayment:o(o=>{if(o&&!e){var t=a.get(o);t||(t=0),(t+=1)>=5&&(n(!0),m.set("PlusHadBlockedCards",!0),t=0),s(new Map(a.set(o,t)))}},[e,n,a]),hasBlockedCardInSession:o(()=>e,[e]),hadBlockedCard:o(()=>!!e||m.has("PlusHadBlockedCards"),[e]),clearAllBlockedCards:o(()=>{e&&n(!1),m.has("PlusHadBlockedCards")&&m.remove("PlusHadBlockedCards")},[e,n])}})(),M=h()?"plus_too_many_failed_payments":a,{login:k}=S({allowClose:!1,forceLogin:n,contextualMessageKey:M}),{userId:x}=s(u);l(()=>{x&&d||f||(C(!0),k(()=>g(!0)).finally(()=>C(!1)))},[k,d,f,x]);var O=o(()=>{window.location=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(S))}&returnTo=${encodeURIComponent(p.path)}&fullscreen=true`},[p.path]),w=i&&v();return l(()=>{w&&O()},[w,O]),w?r?r():null:x&&d?(I(),e({userId:x,failedCardPayment:y})):null},M=e=>!!(null==e?void 0:e.canAccessSecureContent),k=({children:e,contextualMessageKey:n,renderNotSecure:a,skip:o})=>{var{login:i,close:r}=S({allowClose:!1,forceLogin:!0,contextualMessageKey:n}),[{data:c,fetching:d},g]=(()=>{var{userId:e}=s(u),[n,a]=t(null),[o,i]=C({query:p,pause:!e},M);return l(()=>{e!==n&&(a(e),i())},[i,n,e]),l(()=>()=>a(null),[a]),[o,i]})(),[f,m]=t(!1);return l(()=>{c||d||f||o||i(()=>{g(),m(!0)})},[c,g,d,i,f,m,o]),l(()=>()=>r(),[r]),c||o?e():a?a():null};return[()=>{(p=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"CanAccessSecureContent"},"variableDefinitions":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"canAccessSecureContent"},"name":{"kind":"Name","value":"OptimusBenefits_canAccessSecureContent"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":106}}')).__key=0xb7349ab36c89,e({OptimusHardGate:I,OptimusSecureLoginGate:k,useOptimusLogin:S,useOptimusLoginNavigation:v,useOptimusLoginTracking:h})},[e=>(a=e.useMemo,o=e.useCallback,s=e.useContext,t=e.useState,l=e.useEffect),e=>i=e.default,e=>r=e.featureIsEnabled,e=>(u=e.Visitor,c=e.Route),e=>d=e.useOptimusSubscriptionStatusRaw,e=>g=e.useNavigate,e=>f=e.useInteractionLogger,e=>m=e.default,e=>C=e.default]]},["cDcdfi","VANuRt","-i3PJS","2R4xv2","-WwUo-","1yEXVQ","fsml46","jaCyxS","kYmwth"]]);
